  0%|          | 0/1000 [00:00<?, ?it/s]
Traceback (most recent call last):
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/trace_messenger.py", line 147, in __call__
    ret = self.fn(*args, **kwargs)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/messenger.py", line 10, in _context_wrap
    return fn(*args, **kwargs)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/messenger.py", line 10, in _context_wrap
    return fn(*args, **kwargs)
  File "/home/ordabayev/Documents/cosmos/cosmos/models/Modelv6.py", line 133, in model
    theta = pyro.sample("theta", dist.MaskedMixture(z.byte(), dist0, dist1)) # N,F,1,1,M,K
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/primitives.py", line 112, in sample
    apply_stack(msg)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/runtime.py", line 195, in apply_stack
    default_process_message(msg)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/runtime.py", line 156, in default_process_message
    msg["value"] = msg["fn"](*msg["args"], **msg["kwargs"])
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/distributions/torch_distribution.py", line 42, in __call__
    return self.rsample(sample_shape) if self.has_rsample else self.sample(sample_shape)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/distributions/mixture.py", line 104, in sample
    result = self.component0.sample(sample_shape)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/torch/distributions/independent.py", line 82, in sample
    return self.base_dist.sample(sample_shape)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/torch/distributions/multinomial.py", line 91, in sample
    samples = self._categorical.sample(torch.Size((self.total_count,)) + sample_shape)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/torch/distributions/categorical.py", line 107, in sample
    sample_2d = torch.multinomial(probs_2d, 1, True)
RuntimeError: invalid argument 2: prob_dist must be 1 or 2 dim at /pytorch/aten/src/THC/generic/THCTensorRandom.cu:44

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "<stdin>", line 1, in <module>
  File "/home/ordabayev/Documents/cosmos/cosmos/models/Modelv6.py", line 242, in epoch
    epoch_loss = self.svi.step()
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/infer/svi.py", line 100, in step
    loss = self.loss_and_grads(self.model, self.guide, *args, **kwargs)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/infer/traceenum_elbo.py", line 376, in loss_and_grads
    for model_trace, guide_trace in self._get_traces(model, guide, *args, **kwargs):
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/infer/traceenum_elbo.py", line 299, in _get_traces
    self._guess_max_plate_nesting(model, guide, *args, **kwargs)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/infer/elbo.py", line 97, in _guess_max_plate_nesting
    poutine.replay(model, trace=guide_trace)).get_trace(*args, **kwargs)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/trace_messenger.py", line 169, in get_trace
    self(*args, **kwargs)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/trace_messenger.py", line 153, in __call__
    traceback)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/six.py", line 692, in reraise
    raise value.with_traceback(tb)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/trace_messenger.py", line 147, in __call__
    ret = self.fn(*args, **kwargs)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/messenger.py", line 10, in _context_wrap
    return fn(*args, **kwargs)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/messenger.py", line 10, in _context_wrap
    return fn(*args, **kwargs)
  File "/home/ordabayev/Documents/cosmos/cosmos/models/Modelv6.py", line 133, in model
    theta = pyro.sample("theta", dist.MaskedMixture(z.byte(), dist0, dist1)) # N,F,1,1,M,K
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/primitives.py", line 112, in sample
    apply_stack(msg)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/runtime.py", line 195, in apply_stack
    default_process_message(msg)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/poutine/runtime.py", line 156, in default_process_message
    msg["value"] = msg["fn"](*msg["args"], **msg["kwargs"])
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/distributions/torch_distribution.py", line 42, in __call__
    return self.rsample(sample_shape) if self.has_rsample else self.sample(sample_shape)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/pyro/distributions/mixture.py", line 104, in sample
    result = self.component0.sample(sample_shape)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/torch/distributions/independent.py", line 82, in sample
    return self.base_dist.sample(sample_shape)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/torch/distributions/multinomial.py", line 91, in sample
    samples = self._categorical.sample(torch.Size((self.total_count,)) + sample_shape)
  File "/home/ordabayev/anaconda3/envs/pyro/lib/python3.7/site-packages/torch/distributions/categorical.py", line 107, in sample
    sample_2d = torch.multinomial(probs_2d, 1, True)
RuntimeError: invalid argument 2: prob_dist must be 1 or 2 dim at /pytorch/aten/src/THC/generic/THCTensorRandom.cu:44
       Trace Shapes:             
        Param Sites:             
       Sample Sites:             
         offset dist        |    
               value        |    
           gain dist        |    
               value        |    
        N_plate dist        |    
               value     16 |    
        F_plate dist        |    
               value    831 |    
             pi dist        | 2  
               value        | 2  
        junk_pi dist        | 2  
               value        | 2  
 background_loc dist        |    
               value      1 |    
background_beta dist        |    
               value      1 |    
     height_loc dist        |    
               value      1 |    
    height_beta dist        |    
               value      1 |    
      width_loc dist        |    
               value      1 |    
     width_beta dist        |    
               value      1 |    
     background dist 16 831 | 1 1
               value 16 831 | 1 1
              z dist 16 831 |    
               value 16 831 |    
              j dist 16 831 |    
               value 16 831 |    

